<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Organisateurs textuels – Mise en évidence (niveau avancé)</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 to-orange-100 min-h-screen flex items-center justify-center p-4">
  <div id="root" class="w-full max-w-3xl"></div>

  <script type="text/babel">
/*****************************************************************
 *  Variante plus difficile :                                     *
 *  – TOUS les mots/segments deviennent cliquables.               *
 *  – Seuls les organisateurs repertoriés sont notés.             *
 *  – Les autres mots peuvent distraire / fausses pistes.         *
 *****************************************************************/

const CYCLES=["","temps","opp"]; // vide → temps → opp → vide
function nextCat(c){return CYCLES[(CYCLES.indexOf(c)+1)%CYCLES.length];}
const COLORS={temps:"bg-yellow-200",opp:"bg-blue-200"};

// --------- helpers pour banque (inchangé) ---------
function t(word){return {word,cat:"temps"};}
function o(word){return {word,cat:"opp"};}
const BANK=[
  {source:"Victor Hugo – Les Misérables",text:"Il pleuvait depuis l'aube; pourtant, Jean Valjean marchait d'un pas ferme, puis il pressa l'allure, comme s'il voulait semer les souvenirs amers qui le poursuivaient.",tags:[o("pourtant"),t("puis"),o("comme")]},
  {source:"Jules Verne – Le Tour du monde en 80 jours",text:"Phileas Fogg consulta sa montre, ensuite il referma son carnet; bien que les retards se multiplient, il demeurait imperturbable.",tags:[t("ensuite"),o("bien que")]},
  {source:"George Sand – La Mare au Diable",text:"La nuit tombait doucement; cependant, les moissonneurs chantaient encore, à la différence de leurs chevaux qui se reposaient déjà.",tags:[o("cependant"),o("à la différence de")]},
  {source:"Alphonse Daudet – Lettres de mon moulin",text:"Le mistral hurlait au-dessus des pins; néanmoins, la petite chèvre de Monsieur Seguin restait fière, puis elle escalada la montagne.",tags:[o("néanmoins"),t("puis")]},
  {source:"Stendhal – Le Rouge et le Noir",text:"Bien que le salon fût rempli de monde, Julien se sentait seul; plus tard, il s'approcha de la fenêtre.",tags:[o("Bien que"),t("plus tard")]},
  {source:"Guy de Maupassant – Contes de la Bécasse",text:"Il était déjà tard; pourtant ils continuaient leur marche, comme si la fatigue ne les atteignait jamais.",tags:[o("pourtant"),o("comme")]},
  {source:"Émile Zola – Germinal",text:"Étienne avançait dans la galerie; tandis que ses camarades parlaient, il restait silencieux.",tags:[o("tandis que")]},
  {source:"Marcel Proust – Du côté de chez Swann",text:"Il demeura longtemps immobile; pourtant, son esprit vagabondait; bien que la cloche eût sonné, il ne bougea pas.",tags:[o("pourtant"),o("bien que")]}
];
function pick(){return BANK[Math.floor(Math.random()*BANK.length)];}

/* Découpe : on veut chaque mot/pontuation cliquable. On repère organisateurs. */
function tokenize(text){
  const tokens=[];const regex=/\w+|[^\w\s]+|\s+/g;let m;while((m=regex.exec(text))!==null){tokens.push(m[0]);}return tokens;}

function prepareSegments(text,tags){
  // map organiser words (lowercase) to cat
  const map=new Map(tags.map((t,i)=>[t.word.toLowerCase(),{cat:t.cat,idx:i}]));
  return tokenize(text).map(tok=>{
    const key=tok.trim().toLowerCase();
    if(map.has(key)) return {...map.get(key),txt:tok};
    return {cat:null,idx:null,txt:tok};
  });
}

function App(){
  const [para,setPara]=React.useState(pick());
  const [choices,setChoices]=React.useState(()=>Array(para.tags.length).fill(""));
  const [done,setDone]=React.useState(false);
  const refresh=()=>{const p=pick();setPara(p);setChoices(Array(p.tags.length).fill(""));setDone(false);} ;

  const segments=React.useMemo(()=>prepareSegments(para.text,para.tags),[para]);

  const score=para.tags.reduce((s,t,i)=>s+(choices[i]===t.cat?1:0),0);

  const setChoice=(seg)=>{
    if(done) return;
    if(seg.idx===null){seg.fake=nextCat(seg.fake||"");setRenderTick(t=>t+1);return;}
    const arr=[...choices];arr[seg.idx]=nextCat(arr[seg.idx]);setChoices(arr);
  };
  const [renderTick,setRenderTick]=React.useState(0); // force rerender for fake states

  return (
    <div className="bg-white/80 p-6 rounded-2xl shadow-lg space-y-6 max-h-[90vh] overflow-auto">
      <h1 className="text-xl font-bold text-center">Organisateurs textuels (niveau 2)</h1>
      <p className="text-center text-sm italic">{para.source}</p>
      <p className="leading-relaxed text-justify select-none">
        {segments.map((seg,i)=>{
          const col= seg.idx!==null ? COLORS[choices[seg.idx]] : COLORS[seg.fake];
          const border=done && seg.idx!==null ? (choices[seg.idx]===seg.cat? 'border-green-500':'border-red-500') : '';
          return <span key={i} onClick={()=>setChoice(seg)} className={`cursor-pointer ${col||''} ${border?'border-b-2 '+border:''}`}>{seg.txt}</span>;
        })}
      </p>
      {!done
        ? <button onClick={()=>setDone(true)} className="bg-indigo-600 text-white px-4 py-2 rounded-xl block mx-auto">Vérifier</button>
        : <div className="text-center space-y-2"><p className="font-semibold">Score : {score} / {para.tags.length}</p><button onClick={refresh} className="bg-green-600 text-white px-3 py-1 rounded-xl">Nouvel extrait</button></div>}
      <p className="text-xs text-center text-gray-600 mt-1">Clique sur n’importe quel mot pour lui attribuer une catégorie : jaune = temps, bleu = opposition ; reclique pour changer / effacer. Seuls les véritables organisateurs sont notés.</p>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
