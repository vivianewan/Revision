<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Organisateurs textuels – Extraits littéraires</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 to-orange-100 min-h-screen flex items-center justify-center p-4">
  <div id="root" class="w-full max-w-3xl"></div>

  <script type="text/babel">
/*******************************************************
 *  Extraits littéraires (domaine public)               *
 *  Organisateurs LIMITÉS aux notes fournies :          *
 *  - Temps                                             *
 *  - Opposition                                        *
 *  - Concession                                        *
 *  - Comparaison                                       *
 *******************************************************/

const CATEGORIES = [
  {key:"temps", label:"Temps"},
  {key:"opposition", label:"Opposition"},
  {key:"concession", label:"Concession"},
  {key:"comparaison", label:"Comparaison"}
];

const BANK = [
  {
    source:"Victor Hugo – Les Misérables",
    text:"Il pleuvait depuis l'aube; pourtant, Jean Valjean marchait d'un pas ferme, puis il pressa l'allure, comme s'il voulait semer les souvenirs amers qui le poursuivaient." ,
    tags:[
      {word:"pourtant",cat:"opposition"},
      {word:"puis",cat:"temps"},
      {word:"comme",cat:"comparaison"}
    ]
  },
  {
    source:"Jules Verne – Le Tour du monde en 80 jours",
    text:"Phileas Fogg consulta sa montre, ensuite il referma son carnet; bien que les retards se multiplient, il demeurait imperturbable." ,
    tags:[
      {word:"ensuite",cat:"temps"},
      {word:"bien que",cat:"concession"}
    ]
  },
  {
    source:"George Sand – La Mare au Diable",
    text:"La nuit tombait doucement; cependant, les moissonneurs chantaient encore, à la différence de leurs chevaux qui se reposaient déjà." ,
    tags:[
      {word:"cependant",cat:"opposition"},
      {word:"à la différence de",cat:"comparaison"}
    ]
  },
  {
    source:"Alphonse Daudet – Lettres de mon moulin",
    text:"Le mistral hurlait au-dessus des pins; néanmoins, la petite chèvre de Monsieur Seguin restait fière, puis elle escalada la montagne." ,
    tags:[
      {word:"néanmoins",cat:"opposition"},
      {word:"puis",cat:"temps"}
    ]
  },
  {
    source:"Stendhal – Le Rouge et le Noir",
    text:"Bien que le salon fût rempli de monde, Julien se sentait seul; plus tard, il s'approcha de la fenêtre." ,
    tags:[
      {word:"Bien que",cat:"concession"},
      {word:"plus tard",cat:"temps"}
    ]
  },
  {
    source:"Guy de Maupassant – Contes de la Bécasse",
    text:"Il était déjà tard; pourtant ils continuaient leur marche, comme si la fatigue ne les atteignait jamais." ,
    tags:[
      {word:"pourtant",cat:"opposition"},
      {word:"comme",cat:"comparaison"}
    ]
  },
  {
    source:"Émile Zola – Germinal",
    text:"Étienne avançait dans la galerie; tandis que ses camarades parlaient, il restait silencieux." ,
    tags:[
      {word:"tandis que",cat:"temps"}
    ]
  },
  {
    source:"Marcel Proust – Du côté de chez Swann",
    text:"Il demeura longtemps immobile; pourtant, son esprit vagabondait; bien que la cloche eût sonné, il ne bougea pas." ,
    tags:[
      {word:"pourtant",cat:"opposition"},
      {word:"bien que",cat:"concession"}
    ]
  }
];

function randomParagraph(){return BANK[Math.floor(Math.random()*BANK.length)];}

function splitWithTags(text,tags){
  const segments=[];
  let pos=0;
  tags.forEach((t,idx)=>{
    const match=text.toLowerCase().indexOf(t.word.toLowerCase(),pos);
    if(match!==-1){
      segments.push({str:text.slice(pos,match), tag:null});
      segments.push({str:t.word, tag:idx});
      pos=match+t.word.length;
    }
  });
  segments.push({str:text.slice(pos), tag:null});
  return segments;
}

function App(){
  const [para,setPara]=React.useState(randomParagraph());
  const [choices,setChoices]=React.useState(Array(para.tags.length).fill(""));
  const [checked,setChecked]=React.useState(false);

  const refresh=()=>{const p=randomParagraph();setPara(p);setChoices(Array(p.tags.length).fill(""));setChecked(false);} ;

  const score = para.tags.reduce((s,t,i)=>s+(choices[i]===t.cat?1:0),0);

  const segments = React.useMemo(()=>splitWithTags(para.text,para.tags),[para]);

  return (
    <div className="bg-white/80 backdrop-blur p-6 rounded-2xl shadow-lg space-y-6 max-h-[90vh] overflow-auto">
      <h1 className="text-xl font-bold text-center">Organisateurs textuels</h1>
      <p className="text-center text-sm italic">{para.source}</p>

      <p className="leading-relaxed text-justify">
        {segments.map((seg,idx)=>{
          if(seg.tag===null) return <span key={idx}>{seg.str}</span>;
          const correct = choices[seg.tag]===para.tags[seg.tag].cat;
          return (
            <span key={idx} className="inline-flex items-center mx-1">
              <select
                value={choices[seg.tag]}
                onChange={e=>{const arr=[...choices];arr[seg.tag]=e.target.value;setChoices(arr);}}
                className={`border rounded px-1 text-xs ${checked ? (correct? 'border-green-500':'border-red-500') : ''}`}
              >
                <option value="" disabled>---</option>
                {CATEGORIES.map(c=> <option key={c.key} value={c.key}>{c.label}</option>)}
              </select>
              <span className="font-semibold ml-1">{seg.str}</span>
            </span>
          );
        })}
      </p>

      {!checked ? (
        <button onClick={()=>setChecked(true)} className="bg-indigo-600 text-white px-4 py-2 rounded-xl block mx-auto">Vérifier</button>
      ) : (
        <div className="text-center space-y-4">
          <p className="text-lg font-semibold">Score : {score} / {para.tags.length}</p>
          <button onClick={refresh} className="bg-green-600 text-white px-4 py-2 rounded-xl">Nouvel extrait</button>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
